# üíæ Telegram Bot - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–¢–µ–ø–µ—Ä—å –∂–∞–ª–æ–±—ã –∏–∑ Telegram **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**!

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∞–ª–æ–±—É –≤ Telegram
   ‚Üì
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ webhook n8n
   ‚Üì
3. n8n –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ AI
   ‚Üì
4. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
   ‚Üì
5. ‚ú® –ñ–∞–ª–æ–±–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ PostgreSQL
   ‚Üì
6. –ñ–∞–ª–æ–±–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ!
```

## üìä –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

–ò–∑ Telegram –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:

| –ü–æ–ª–µ | –û—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è | –ü—Ä–∏–º–µ—Ä |
|------|---------------|--------|
| `rawText` | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | "65 –∞–≤—Ç–æ–±—É—Å ”©—Ç–µ –µ—Å–∫—ñ" |
| `route` | AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞ | "65" |
| `place` | AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞ | "–ú–æ–º—ã—à“±–ª—ã-–ü–∞–Ω—Ñ–∏–ª–æ–≤" |
| `actor` | AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç | "–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ" |
| `priority` | AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç | "–ñ–æ“ì–∞—Ä—ã" |
| `aspect[]` | AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞—Å—Å–∏–≤ | ["–ê–≤—Ç–æ–±—É—Å —Å–∞–ø–∞—Å—ã", "–ú—ñ–Ω–µ–∑-“õ“±–ª—ã“õ"] |
| `confidence` | AI —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å | 0.87 |
| `createdBy` | Telegram username | "@user123" |
| `status` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | "NEW" |
| `latitude/longitude` | –ï—Å–ª–∏ AI –æ–ø—Ä–µ–¥–µ–ª–∏—Ç | 43.238949, 76.889709 |

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É —á–µ—Ä–µ–∑ Telegram

```
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: /complaint
3. –ù–∞–ø–∏—à–∏—Ç–µ –∂–∞–ª–æ–±—É: "12 –∞–≤—Ç–æ–±—É—Å –∫–µ—à—ñ–≥–µ–¥—ñ"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
tail -f logs/application.log
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üì§ Sending complaint to webhook from Telegram user: user123
‚úÖ Webhook response received, saving to database...
üíæ Complaint saved to database with ID: abc-123-def from Telegram user: user123
üìä Route: 12, Place: –ê–ª–∞—Ç–∞—É, Priority: –û—Ä—Ç–∞—à–∞
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
SELECT * FROM complaints WHERE created_by LIKE '%telegram%' ORDER BY created_at DESC LIMIT 10;
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥: `http://localhost:5173`
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ admin (admin / admin123)
3. –ñ–∞–ª–æ–±–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ!

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é  
‚úÖ **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –∂–∞–ª–æ–±—ã –∏–∑ Telegram –≤–∏–¥–Ω—ã –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ  
‚úÖ **–ò—Å—Ç–æ—Ä–∏—è** - –≤—Å–µ –∂–∞–ª–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å timestamp  
‚úÖ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª (`createdBy`)  
‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∂–∞–ª–æ–±—ã –∏–∑ Telegram –≤—Ö–æ–¥—è—Ç –≤ –æ–±—â—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É  
‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –º–æ–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∂–∞–ª–æ–±—ã –ø–æ username

## üì± –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û—Ç–ø—Ä–∞–≤–∫–∞ –∂–∞–ª–æ–±—ã

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Telegram:**
```
/complaint
```

**–ë–æ—Ç:**
```
üìù –ñ–∞–ª–æ–±–∞ –∂—ñ–±–µ—Ä—É —Ä–µ–∂–∏–º—ñ

–ï–Ω–¥—ñ “õ–æ“ì–∞–º–¥—ã“õ –∫”©–ª—ñ–∫—Ç–µ–≥—ñ –º”ô—Å–µ–ª–µ–Ω—ñ –∂–∞–∑—ã“£—ã–∑.
```

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
```
95 –º–∞—Ä—à—Ä—É—Ç—Ç–∞ –∂“Ø—Ä–≥—ñ–∑—É—à—ñ ”©—Ç–µ –∂—ã–ª–¥–∞–º –∂“Ø—Ä–µ–¥—ñ, “õ–∞—É—ñ–ø—Ç—ñ!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚è≥ –ë–æ—Ç: "–ñ–∞–ª–æ–±–∞ ”©“£–¥–µ–ª—É–¥–µ..."
2. üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ webhook
3. ü§ñ AI –æ–±—Ä–∞–±–æ—Ç–∫–∞
4. üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:
   - route: "95"
   - place: "–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"
   - priority: "”®—Ç–µ –∂–æ“ì–∞—Ä—ã"
   - aspect: ["“ö–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫", "–ñ“Ø—Ä–≥—ñ–∑—É —Å—Ç–∏–ª—ñ"]
5. ‚úÖ –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
6. üìä –ñ–∞–ª–æ–±–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```java
// –í TelegramBotService.java
public Mono<String> processComplaintText(String text, String username) {
    // 1. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ webhook
    return webClientBuilder.build()
        .post()
        .uri(webhookUrl)
        .bodyValue(requestBody)
        .retrieve()
        .bodyToMono(String.class)
        .doOnSuccess(response -> {
            // 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
            saveComplaintFromWebhook(text, response, username);
        });
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ webhook

–û–∂–∏–¥–∞–µ–º—ã–π JSON –æ—Ç n8n:

```json
{
  "route": "65",
  "object": "–ê–≤—Ç–æ–±—É—Å",
  "place": "–ú–æ–º—ã—à“±–ª—ã-–ü–∞–Ω—Ñ–∏–ª–æ–≤ –∞—è–ª–¥–∞–º–∞—Å—ã",
  "actor": "–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ",
  "priority": "–ñ–æ“ì–∞—Ä—ã",
  "aspects": ["–ê–≤—Ç–æ–±—É—Å —Å–∞–ø–∞—Å—ã", "–ú—ñ–Ω–µ–∑-“õ“±–ª—ã“õ"],
  "confidence": 0.87,
  "latitude": 43.238949,
  "longitude": 76.889709
}
```

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ:

- üìä –í–∏–¥–µ—Ç—å –≤—Å–µ –∂–∞–ª–æ–±—ã –∏–∑ Telegram –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
- üó∫Ô∏è –ñ–∞–ª–æ–±—ã –∏–∑ Telegram –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ
- ‚è±Ô∏è –ñ–∞–ª–æ–±—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ç–∞–π–º–ª–∞–π–Ω–µ
- üìà –í–∫–ª—é—á–∞—é—Ç—Å—è –≤ –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- üîç –ú–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ username
- üí¨ –ú–æ–∂–Ω–æ –æ–±—Å—É–∂–¥–∞—Ç—å —á–µ—Ä–µ–∑ AI –ø–æ–º–æ—â–Ω–∏–∫–∞

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à Telegram –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å–∏—Å—Ç–µ–º–æ–π!

---

**–î–∞—Ç–∞:** 07.11.2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

